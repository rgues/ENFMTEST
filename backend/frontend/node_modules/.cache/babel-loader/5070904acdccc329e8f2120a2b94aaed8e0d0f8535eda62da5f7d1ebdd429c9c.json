{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { GET_REQUESTS, GET_ASSIGNATIONS, GET_CATEGORIES, GET_ANSWERS, APPROVE_ANSWER, GET_USERS } from '../store/types';\nimport { format } from \"date-fns\";\nimport { onMounted } from 'vue';\nimport store from '../store';\nimport router from '../routes';\nexport default {\n  __name: 'Answer',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const categories = ref([]);\n    const users = ref([]);\n    const requests = ref([]);\n    const assignations = ref([]);\n    const answers = ref([]);\n    const currentUser = ref(null);\n    const loading = ref(false);\n    onMounted(async () => {\n      categories.value = await store.dispatch(GET_CATEGORIES);\n      users.value = await store.dispatch(GET_USERS);\n      requests.value = await store.dispatch(GET_REQUESTS);\n      assignations.value = await store.dispatch(GET_ASSIGNATIONS);\n      answers.value = await store.dispatch(GET_ANSWERS);\n      currentUser.value = store.state.user.loginData.user;\n    });\n    function categoryName(id) {\n      return categories.value.filter(item => item.id === id).map(item => item ? item.name : '')[0];\n    }\n    function userName(id) {\n      return users.value.filter(item => item.id === id).map(item => item ? item.firstname + ' ' + item.lastname : '')[0];\n    }\n    function request(id) {\n      return requests.value.find(item => item.id === id);\n    }\n    function assignation(id) {\n      return assignations.value.find(item => item.id === id);\n    }\n    function approveResponse(item) {\n      const data = {\n        description: item.description,\n        assignation_id: item.assignation_id,\n        state: \"approve\",\n        id: item.id\n      };\n      loading.value = true;\n      store.dispatch(APPROVE_ANSWER, data).then(async reponse => {\n        loading.value = false;\n        if (reponse.status === 'success') {\n          router.push('/admin/dashboard');\n        }\n      }).catch(err => {\n        loading.value = false;\n        if (err === 'error') {\n          alert(store.state.request.message);\n        }\n      });\n    }\n    function formatDate(date) {\n      return format(date, \"yyyy-MM-dd\");\n    }\n    const __returned__ = {\n      categories,\n      users,\n      requests,\n      assignations,\n      answers,\n      currentUser,\n      loading,\n      categoryName,\n      userName,\n      request,\n      assignation,\n      approveResponse,\n      formatDate,\n      get GET_REQUESTS() {\n        return GET_REQUESTS;\n      },\n      get GET_ASSIGNATIONS() {\n        return GET_ASSIGNATIONS;\n      },\n      get GET_CATEGORIES() {\n        return GET_CATEGORIES;\n      },\n      get GET_ANSWERS() {\n        return GET_ANSWERS;\n      },\n      get APPROVE_ANSWER() {\n        return APPROVE_ANSWER;\n      },\n      get GET_USERS() {\n        return GET_USERS;\n      },\n      get format() {\n        return format;\n      },\n      onMounted,\n      get store() {\n        return store;\n      },\n      get router() {\n        return router;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["GET_REQUESTS","GET_ASSIGNATIONS","GET_CATEGORIES","GET_ANSWERS","APPROVE_ANSWER","GET_USERS","format","onMounted","store","router","categories","ref","users","requests","assignations","answers","currentUser","loading","value","dispatch","state","user","loginData","categoryName","id","filter","item","map","name","userName","firstname","lastname","request","find","assignation","approveResponse","data","description","assignation_id","then","reponse","status","push","catch","err","alert","message","formatDate","date"],"sources":["C:/Users/HP/Desktop/ENFM/Customer_v2/client/src/views/Answer.vue"],"sourcesContent":["\r\n<script setup>\r\nimport { GET_REQUESTS,GET_ASSIGNATIONS, GET_CATEGORIES,GET_ANSWERS, APPROVE_ANSWER,GET_USERS} from '../store/types'\r\nimport { format } from \"date-fns\"\r\nimport { onMounted } from 'vue'\r\nimport store from '../store'\r\nimport router from '../routes'\r\n\r\n const categories = ref([])\r\n const users = ref([])\r\n const requests  = ref([])\r\n const assignations  = ref([])\r\n const answers = ref([])\r\n const currentUser = ref(null)\r\n const loading = ref(false)\r\n\r\n onMounted(async() => { \r\n       categories.value = await store.dispatch(GET_CATEGORIES);\r\n       users.value = await store.dispatch(GET_USERS);\r\n       requests.value = await store.dispatch(GET_REQUESTS);\r\n       assignations.value = await store.dispatch(GET_ASSIGNATIONS);\r\n       answers.value = await store.dispatch(GET_ANSWERS);\r\n       currentUser.value = store.state.user.loginData.user;\r\n })\r\n\r\n      function  categoryName(id) {\r\n          return categories.value.filter(item => item.id === id)\r\n          .map(item=>item ? item.name : '')[0];\r\n       }\r\n         \r\n       function userName(id) {\r\n          return users.value.filter(item => item.id === id)\r\n          .map(item=>item ? item.firstname + ' ' + item.lastname : '')[0];\r\n        }\r\n        \r\n        function  request(id) {\r\n           return requests.value.find(item => item.id === id);\r\n        }\r\n        \r\n         function assignation(id) {\r\n           return assignations.value.find(item => item.id === id);\r\n        }\r\n       \r\n        function approveResponse(item) {\r\n           \r\n            const data = { \r\n                description: item.description,\r\n                assignation_id: item.assignation_id,\r\n                state:\"approve\",\r\n                id: item.id\r\n            }\r\n            loading.value = true;\r\n            store.dispatch(APPROVE_ANSWER,data).then(async reponse => {\r\n                 loading.value = false;\r\n                if (reponse.status === 'success') {\r\n                    router.push('/admin/dashboard')\r\n                } \r\n            }).catch(err => {\r\n                   loading.value = false;\r\n                    if(err === 'error') {\r\n                        alert(store.state.request.message);\r\n                    }\r\n                   \r\n            })\r\n        }\r\n\r\n       function formatDate(date) {\r\n                return format(date,\"yyyy-MM-dd\");\r\n        }\r\n\r\n</script>\r\n\r\n\r\n<template>\r\n  <div class=\"admin-container mt-5\">\r\n    <div className=\"admin_table\">\r\n      <table class=\"table\" >\r\n        <thead>\r\n          <tr class=\"table-secondary\">\r\n            <th scope=\"col\">Ticket</th>\r\n            <th scope=\"col\">Category</th>\r\n            <th scope=\"col\">Description</th>\r\n            <th scope=\"col\">Status</th>\r\n            <th scope=\"col\">Comment</th>\r\n            <th scope=\"col\">Response</th>\r\n             <th scope=\"col\">IT</th>\r\n            <th scope=\"col\">Date </th>\r\n            <th scope=\"col\" v-if=\"currentUser.role_id ===2\">Action</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n           <tr class=\"table-light\" v-for=\"item in answers\" :key=\"item.id\" >\r\n\r\n                    <td>\r\n                      {{ assignation(item.assignation_id) ? request(assignation(item.assignation_id).request_id).title : ''}}\r\n                    </td>\r\n                    <td>\r\n                        <span class=\"fw-bold\" >\r\n                            {{ assignation(item.assignation_id) ? categoryName(request(assignation(item.assignation_id).request_id).category_id) : ''  }}\r\n                        </span>\r\n                    </td>\r\n                   \r\n                    <td>\r\n                        {{ assignation(item.assignation_id) ?  request(assignation(item.assignation_id).request_id).description : ''}}\r\n                    </td>\r\n                    <td>\r\n                      <span :class=\"{'badge bg-danger':item.state==='in_approval','badge bg-success':item.state==='approve' }\">\r\n                        {{item.state}}\r\n                      </span> \r\n                      </td>\r\n                    <td>\r\n                        <span class=\"fs-6\" >\r\n                            {{assignation(item.assignation_id) ? assignation(item.assignation_id).comment : ''}}\r\n                        </span>\r\n                    </td>\r\n\r\n                     <td>{{item.description ? item.description : ''}}</td>\r\n\r\n                    <td>{{assignation(item.assignation_id) ? userName(assignation(item.assignation_id).user_id) : '' }}</td>\r\n                  \r\n                  \r\n                    <td>{{ item.date_answer ? formatDate(item.date_answer) : ''}}</td>\r\n                    <td>\r\n                     \r\n                        <button @click=\"approveResponse(item)\" :disabled=\"item.state==='approve' && loading\" v-if=\"currentUser.role_id ===2\" :class=\"{'btn btn-small btn-secondary':item.state==='in_approval' , \r\n                        'btn btn-small btn-light':item.state==='approve' }\" >\r\n                            Confirm\r\n                        </button>\r\n                    </td>\r\n               </tr> \r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}