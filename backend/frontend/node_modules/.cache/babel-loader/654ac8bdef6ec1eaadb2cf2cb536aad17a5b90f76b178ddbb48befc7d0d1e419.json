{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { onMounted, ref, watchEffect } from \"vue\";\nimport { ADD_ASSIGNATION, GET_ASSIGNATIONS, GET_USERS, GET_REQUESTS } from \"../store/types\";\nimport store from '../store';\nimport router from '../routes';\nimport { useRoute } from 'vue-router';\nexport default {\n  __name: 'AddAssignation',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const route = useRoute();\n    const user_id = ref('');\n    const comment = ref('');\n    const request_id = ref('');\n    const assigner = ref('');\n    const assignError = ref('');\n    const users = ref([]);\n    const requests = ref([]);\n    const assignations = ref([]);\n    const loading = ref(false);\n    const reassign = ref(false);\n    onMounted(async () => {\n      assignations.value = await store.dispatch(GET_ASSIGNATIONS);\n      users.value = await store.dispatch(GET_USERS);\n      requests.value = await store.dispatch(GET_REQUESTS);\n      if (users.value && users.value.length) {\n        users.value = users.value.filter(item => item.role_id === 3);\n      }\n      if (requests.value && requests.value.length) {\n        requests.value = requests.value.filter(item => item.status === 'proccesing');\n      }\n      if (route.params.id || route.params.user) {\n        request_id.value = route.params.id;\n        assigner.value = route.params.user;\n        reassign.value = true;\n        users.value = users.value.filter(item => item.id !== parseInt(assigner.value));\n      }\n    });\n    watchEffect(() => (route.params.id, route.params.user), async (newId1, newId2) => {\n      request_id.value = newId1;\n      assigner.value = newId2;\n      users.value = users.value.filter(item => item.id !== parseInt(assigner.value));\n    });\n    function saveAssignRequest() {\n      loading.value = true;\n      const data = {\n        request_id: request_id.value,\n        user_id: user_id.value,\n        comment: comment.value\n      };\n      store.dispatch(ADD_ASSIGNATION, data).then(data => {\n        loading.value = false;\n        if (data.status === \"success\") {\n          router.push(\"/admin/dashboard/assignations\");\n        }\n      }).catch(data => {\n        loading.value = false;\n        if (data === \"error\") {\n          assignError.value = store.state.request.message;\n        }\n      });\n    }\n    function updateRequest() {\n      // Get user assignations\n      if (assignations.value && assignations.value.length) {\n        assignations.value = assignations.value.filter(item => parseInt(item.user_id) === parseInt(user_id.value));\n      }\n\n      // remove request that is already assign to the user\n      if (assignations.value && assignations.value.length) {\n        assignations.value.map(assign => {\n          requests.value = requests.value.filter(item => parseInt(assign.request_id) !== parseInt(item.id));\n        });\n      }\n    }\n    const __returned__ = {\n      route,\n      user_id,\n      comment,\n      request_id,\n      assigner,\n      assignError,\n      users,\n      requests,\n      assignations,\n      loading,\n      reassign,\n      saveAssignRequest,\n      updateRequest,\n      onMounted,\n      ref,\n      watchEffect,\n      get ADD_ASSIGNATION() {\n        return ADD_ASSIGNATION;\n      },\n      get GET_ASSIGNATIONS() {\n        return GET_ASSIGNATIONS;\n      },\n      get GET_USERS() {\n        return GET_USERS;\n      },\n      get GET_REQUESTS() {\n        return GET_REQUESTS;\n      },\n      get store() {\n        return store;\n      },\n      get router() {\n        return router;\n      },\n      get useRoute() {\n        return useRoute;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["onMounted","ref","watchEffect","ADD_ASSIGNATION","GET_ASSIGNATIONS","GET_USERS","GET_REQUESTS","store","router","useRoute","route","user_id","comment","request_id","assigner","assignError","users","requests","assignations","loading","reassign","value","dispatch","length","filter","item","role_id","status","params","id","user","parseInt","newId1","newId2","saveAssignRequest","data","then","push","catch","state","request","message","updateRequest","map","assign"],"sources":["C:/Users/HP/Desktop/ENFM/Customer_v2/client/src/views/AddAssignation.vue"],"sourcesContent":["<script setup>\r\nimport { onMounted, ref, watchEffect } from \"vue\";\r\nimport { ADD_ASSIGNATION,GET_ASSIGNATIONS, GET_USERS, GET_REQUESTS } from \"../store/types\"\r\nimport store from '../store'\r\nimport router from '../routes'\r\nimport { useRoute } from 'vue-router'\r\n\r\n     const route = useRoute()\r\n     const user_id = ref('')\r\n     const comment = ref('')\r\n     const request_id = ref('')\r\n     const assigner = ref('')\r\n     const assignError = ref('')\r\n     const users = ref([])\r\n     const requests = ref([]) \r\n     const assignations = ref([])\r\n     const loading = ref(false)\r\n     const reassign = ref(false)\r\n\r\n    onMounted(async () =>{\r\n\r\n      assignations.value = await store.dispatch(GET_ASSIGNATIONS);\r\n      users.value = await store.dispatch(GET_USERS);\r\n      requests.value = await store.dispatch(GET_REQUESTS);\r\n    \r\n     if (users.value &&  users.value.length) {\r\n         users.value = users.value.filter(item => item.role_id === 3);\r\n     }\r\n\r\n     if (requests.value &&  requests.value.length) {\r\n        requests.value = requests.value.filter(item => item.status === 'proccesing');\r\n     }\r\n\r\n     if (route.params.id || route.params.user) {\r\n        request_id.value = route.params.id;\r\n        assigner.value = route.params.user;\r\n        reassign.value = true;\r\n        users.value = users.value.filter(item => item.id !== parseInt(assigner.value));\r\n     }\r\n \r\n  })\r\n\r\n     watchEffect(\r\n      () => (route.params.id, route.params.user),\r\n      async (newId1,newId2) => {\r\n\r\n        request_id.value = newId1;\r\n        assigner.value = newId2;\r\n        users.value = users.value.filter(item => item.id !== parseInt(assigner.value));\r\n      }\r\n    )\r\n\r\n\r\n    function saveAssignRequest() {\r\n      \r\n      loading.value = true;\r\n      const data = {\r\n        request_id: request_id.value,\r\n        user_id: user_id.value,\r\n        comment: comment.value\r\n      };\r\n        store\r\n        .dispatch(ADD_ASSIGNATION, data)\r\n        .then((data) => {\r\n          loading.value = false;\r\n          if (data.status === \"success\") {\r\n             router.push(\"/admin/dashboard/assignations\");\r\n          }\r\n        })\r\n        .catch((data) => {\r\n          loading.value = false;\r\n          if (data === \"error\") {\r\n            assignError.value = store.state.request.message;\r\n          }\r\n        });\r\n    }\r\n\r\n     function updateRequest() {\r\n\r\n      // Get user assignations\r\n      if (assignations.value &&  assignations.value.length) {\r\n         assignations.value = assignations.value.filter(item => parseInt(item.user_id) === parseInt(user_id.value));\r\n      }\r\n \r\n     // remove request that is already assign to the user\r\n     if (assignations.value &&  assignations.value.length) {\r\n         assignations.value.map((assign) => {\r\n                requests.value = requests.value.filter(item => parseInt(assign.request_id) !== parseInt(item.id));\r\n         });\r\n     }\r\n  }\r\n</script>\r\n\r\n\r\n<template>\r\n  <form class=\"m-10 p-5\">\r\n    <div class=\"mb-4\">\r\n      <h3 class=\"text-dark\">ASSIGN REQUEST</h3>\r\n    </div>\r\n\r\n    <div class=\"mb-3\">\r\n      <p class=\"alert alert-danger\" v-show=\"assignError\">{{ assignError }}</p>\r\n    </div>\r\n\r\n    <div class=\"mb-3\">\r\n      <select class=\"form-control\" id=\"#it\" @change=\"updateRequest\" v-model=\"user_id\">\r\n        <option for=\"it\" value=\"\" :disabled=\"true\">\r\n          Select IT\r\n        </option>\r\n        <option for=\"it\" v-for=\"user in users\" :key=\"user.id\" :value=\"user.id\">\r\n          {{ user.firstname }}  {{ user.lastname }}\r\n        </option>\r\n      </select>\r\n    </div>\r\n\r\n    <div class=\"mb-3\" v-if=\"user_id && !reassign\">\r\n      <select class=\"form-control\" id=\"#request\"   v-model=\"request_id\">\r\n        <option for=\"request\" value=\"\" :disabled=\"true\">\r\n          Select Request\r\n        </option>\r\n        <option for=\"request\" v-for=\"req in requests\" :key=\"req.id\" :value=\"req.id\">\r\n          {{ req.description }} \r\n        </option>\r\n      </select>\r\n    </div>\r\n\r\n    <div class=\"mb-3\">\r\n      <textarea\r\n        rows=\"3\"\r\n        v-model=\"comment\"\r\n        class=\"form-control\"\r\n        id=\"passwordInput\"\r\n        placeholder=\"Enter a comment\"\r\n      />\r\n    </div>\r\n\r\n    <div class=\"mb-3\">\r\n      <button\r\n        :disabled=\"loading\"\r\n        @click.prevent=\"saveAssignRequest\"\r\n        :class=\"{'btn btn-lg btn-dark':!loading,'btn btn-lg btn-danger':loading}\"\r\n        type=\"button\"\r\n      >\r\n        Save\r\n      </button>\r\n    </div>\r\n  </form>\r\n</template>\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}